<main class="events-page-container">
  <div class="header-container">
    <div>
      <h1 class="main-title">Próximos Eventos</h1>
      <p class="main-subtitle">Fique por dentro de tudo que vai acontecer no mundo da tecnologia.</p>
    </div>
    <button *ngIf="isAdmin" class="admin-create-button" (click)="openCreateEventForm()">
      + Cadastrar Evento
    </button>
  </div>
  
  <div class="events-grid">
    <div *ngFor="let evt of events" class="event-card" (click)="showDetails(evt)">
      <img class="event-image" [src]="evt.imageUrl" [alt]="evt.nameEvent">
      <div class="event-info">
        <h3 class="event-title">{{ evt.nameEvent }}</h3>
        <p class="event-date">{{ evt.startDate | date: 'dd/MM/yyyy' }}</p>
        <p class="event-description">{{ evt.description }}</p>
      </div>
    </div>
  </div>

  <div *ngIf="selectedEvent" class="details-overlay" (click)="closeDetails()">
    <div class="details-card" (click)="$event.stopPropagation()">
      <button class="close-button" (click)="closeDetails()">×</button>
      <div class="details-header">
        <h2>{{ selectedEvent.nameEvent }}</h2>
        <button *ngIf="isAdmin" class="admin-create-button small" (click)="openCreateLectureForm()">
          + Adicionar Palestra
        </button>
      </div>

      <div class="info-grid">
        <div class="info-item">
          <strong><i class="icon-calendar"></i> Data</strong>
          <span>{{ selectedEvent.startDate | date: 'dd/MM' }} a {{ selectedEvent.endDate | date: 'dd/MM/yyyy' }}</span>
        </div>
        <div class="info-item">
          <strong><i class="icon-location"></i> Local</strong>
          <span>{{ selectedEvent.address }}</span>
        </div>
      </div>

      <h3 class="section-heading">Sobre o Evento</h3>
      <p class="details-description">{{ selectedEvent.description }}</p>

      <app-event-lectures *ngIf="selectedEvent.lectures && selectedEvent.lectures.length > 0"
        [lectures]="selectedEvent.lectures">
      </app-event-lectures>

      <button class="cta-button" (click)="subscribeToMainEvent()">
        Finalizar Inscrição no Evento
      </button>

    </div>
  </div>

  <div *ngIf="isCreatingEvent" class="form-overlay" (click)="closeCreateEventForm()">
    <div class="form-card" (click)="$event.stopPropagation()">
      <h3>Cadastrar Novo Evento</h3>
      <form (ngSubmit)="saveNewEvent()">
        <div class="form-group">
          <label for="eventName">Nome do Evento</label>
          <input type="text" id="eventName" [(ngModel)]="newEvent.nameEvent" name="nameEvent" required>
        </div>
        <div class="form-group">
          <label for="eventAddress">Endereço</label>
          <input type="text" id="eventAddress" [(ngModel)]="newEvent.address" name="address">
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="eventStartDate">Data de Início</label>
            <input type="date" id="eventStartDate" [(ngModel)]="newEvent.startDate" name="startDate">
          </div>
          <div class="form-group">
            <label for="eventEndDate">Data de Fim</label>
            <input type="date" id="eventEndDate" [(ngModel)]="newEvent.endDate" name="endDate">
          </div>
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="eventStartTime">Hora de Início</label>
            <input type="time" id="eventStartTime" [(ngModel)]="newEvent.startTime" name="startTime">
          </div>
          <div class="form-group">
            <label for="eventEndTime">Hora de Fim</label>
            <input type="time" id="eventEndTime" [(ngModel)]="newEvent.endTime" name="endTime">
          </div>
        </div>
        <div class="form-group">
          <label for="eventDescription">Descrição</label>
          <textarea id="eventDescription" [(ngModel)]="newEvent.description" name="description" rows="3"></textarea>
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="eventType">Tipo de Evento</label>
            <select id="eventType" [(ngModel)]="newEvent.eventTypeId" name="eventTypeId" required>
              <option [ngValue]="null" disabled>Selecione um tipo</option>
              <option *ngFor="let type of eventTypes" [value]="type.eventTypeId">{{ type.nameEventType }}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="eventManager">Gerente do Evento</label>
            <select id="eventManager" [(ngModel)]="newEvent.eventManagerId" name="eventManagerId" required>
              <option [ngValue]="null" disabled>Selecione um gerente</option>
              <option *ngFor="let manager of eventManagers" [value]="manager.eventManagerId">{{ manager.name }}</option>
            </select>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="cancel-button" (click)="closeCreateEventForm()">Cancelar</button>
          <button type="submit" class="cta-button">Salvar Evento</button>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="isCreatingLecture" class="form-overlay" (click)="closeCreateLectureForm()">
    <div class="form-card" (click)="$event.stopPropagation()">
      <h3>Cadastrar Nova Palestra</h3>
      <form (ngSubmit)="saveNewLecture()">
        <div class="form-group">
          <label for="lectureName">Nome da Palestra</label>
          <input type="text" id="lectureName" [(ngModel)]="newLecture.nameEventLecture" name="nameEventLecture"
            required>
        </div>
        <div class="form-group">
          <label for="lectureSpeaker">Palestrante</label>
          <input type="text" id="lectureSpeaker" [(ngModel)]="newLecture.speaker" name="speaker" required>
        </div>
        <div class="form-group">
          <label for="lectureAddress">Endereço</label>
          <input type="text" id="lectureAddress" [(ngModel)]="newLecture.address" name="address">
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="lectureStartDate">Data de Início</label>
            <input type="date" id="lectureStartDate" [(ngModel)]="newLecture.startDate" name="startDate">
          </div>
          <div class="form-group">
            <label for="lectureEndDate">Data de Fim</label>
            <input type="date" id="lectureEndDate" [(ngModel)]="newLecture.endDate" name="endDate">
          </div>
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="lectureStartTime">Hora de Início</label>
            <input type="time" id="lectureStartTime" [(ngModel)]="newLecture.startTime" name="startTime">
          </div>
          <div class="form-group">
            <label for="lectureEndTime">Hora de Fim</label>
            <input type="time" id="lectureEndTime" [(ngModel)]="newLecture.endTime" name="endTime">
          </div>
        </div>
        <div class="form-group-row">
          <div class="form-group">
            <label for="lectureVacancies">Nº de Vagas</label>
            <input type="number" id="lectureVacancies" [(ngModel)]="newLecture.quantityVacancies"
              name="quantityVacancies">
          </div>
          <div class="form-group">
            <label for="lectureManager">Gerente Responsável</label>
            <select id="lectureManager" [(ngModel)]="newLecture.eventManagerId" name="eventManagerId" required>
              <option [ngValue]="null" disabled>Selecione um gerente</option>
              <option *ngFor="let manager of eventManagers" [value]="manager.eventManagerId">{{ manager.name }}</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="lectureDescription">Descrição</label>
          <textarea id="lectureDescription" [(ngModel)]="newLecture.description" name="description" rows="3"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="cancel-button" (click)="closeCreateLectureForm()">Cancelar</button>
          <button type="submit" class="cta-button">Salvar Palestra</button>
        </div>
      </form>
    </div>
  </div>

</main>